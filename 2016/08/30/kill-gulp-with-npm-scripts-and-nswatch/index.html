<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用 npm scripts 和 nswatch 替代 gulp | 庶民样本</title>
    <meta name="description" content="EGOIST 在这里写作">
    
    
    <link rel="preload" href="/vuepress-theme-egoist/assets/css/styles.styles.6c3b407a.css" as="style"><link rel="preload" href="/vuepress-theme-egoist/assets/js/app.fab1506c.js" as="script"><link rel="preload" href="/vuepress-theme-egoist/assets/js/3.cef0e0f4.js" as="script"><link rel="preload" href="/vuepress-theme-egoist/assets/js/33.931738c4.js" as="script"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/60.3d9e1b9d.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/29.2cd2d664.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/0.5c65222e.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/1.d72961ee.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/2.2ebdbb9d.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/4.c4900291.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/5.72a7a525.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/6.a77a809c.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/7.a677842b.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/8.8236a500.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/9.edc642b0.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/10.562bb5a7.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/11.da34b2d7.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/12.0d76a7a7.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/13.1151c8ca.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/14.ab009313.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/15.850f06ea.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/16.49a13182.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/17.2b020610.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/18.204d1768.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/19.22869ba0.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/20.6bf7393d.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/21.41355cf4.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/22.ffc9d5dd.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/23.33912496.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/24.dbc15e0b.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/25.1372877b.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/26.26f7c8f0.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/27.ad505b38.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/28.df22de2e.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/30.09373f65.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/31.e0a48837.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/32.59bcb491.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/34.03291722.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/35.1e2c8b69.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/36.962c23e8.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/37.f34abde1.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/38.21819922.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/39.60d2fc33.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/40.8bb7993a.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/41.63f32a9a.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/42.f4daf9bb.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/43.62a117ec.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/44.7627ec8d.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/45.f82943d6.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/46.62677908.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/47.7ed67db0.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/48.a334a8bf.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/49.af5b92b5.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/50.a27fa0a6.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/51.5f37b3d5.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/52.d3820119.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/53.0cb37067.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/54.df98f970.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/55.5a68d05b.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/56.1e5fb376.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/57.de3c4634.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/58.7ad6546d.js"><link rel="prefetch" href="/vuepress-theme-egoist/assets/js/59.e7eb5b8d.js">
    <link rel="stylesheet" href="/vuepress-theme-egoist/assets/css/styles.styles.6c3b407a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-v-4eb3e300><header class="header" data-v-0c022ddd data-v-4eb3e300><h1 class="site-name" data-v-0c022ddd><a href="/vuepress-theme-egoist/" class="router-link-active" data-v-0c022ddd>
      e.z.
    </a></h1> <ul class="nav" data-v-0c022ddd><li class="nav-item" data-v-0c022ddd><a href="/vuepress-theme-egoist/about.html" data-v-0c022ddd>about</a></li><li class="nav-item" data-v-0c022ddd><a href="/vuepress-theme-egoist/girls.html" data-v-0c022ddd>girls</a></li><li class="nav-item" data-v-0c022ddd><a href="/vuepress-theme-egoist/donate.html" data-v-0c022ddd>donate</a></li><li class="nav-item" data-v-0c022ddd><a href="/vuepress-theme-egoist/tag/" data-v-0c022ddd>tags</a></li></ul></header> <div class="main" data-v-4eb3e300><div class="page-header" data-v-4eb3e300><h1 class="page-title" data-v-4eb3e300>用 npm scripts 和 nswatch 替代 gulp</h1> <h2 class="page-subtitle" data-v-4eb3e300>
        Long live gulp, I use npm script
      </h2></div> <div class="page-body" data-v-4eb3e300><!----> <div class="markdown-body" data-v-4eb3e300><div class="content custom" data-v-4eb3e300><h2 id="为什么用-npm-scripts"><a href="#为什么用-npm-scripts" aria-hidden="true" class="header-anchor">#</a> <span>为什么用 npm scripts ?</span></h2> <p>首先我觉得  <a href="https://medium.freecodecamp.com/why-i-left-gulp-and-grunt-for-npm-scripts-3d6853dd22b8#.8wsejnq0u" target="_blank" rel="noopener noreferrer">Why I Left Gulp and Grunt for npm Scripts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 里说的不用 gulp 的理由基本没有道理:</p> <ol><li>gulp 插件质量、数量和实时性</li></ol> <p>作者抱怨 gulp 插件的质量取决于插件作者，这可以理解，<strong>但是 npm 的包同样取决于作者啊</strong>。</p> <p>作者抱怨 gulp 插件的数量不如 npm，<strong>这不是废话吗</strong>。</p> <p>作者抱怨 gulp 插件不能及时更新，比如 babel 6 升级了 gulp-babel 并没有立刻升级。<strong>又不是看直播，干嘛实时?</strong></p> <ol start="2"><li>debug 很痛苦，gulp crash 掉是因为某个插件吗还是因为版本问题</li></ol> <p>额，难道直接用 npm package 就没有这些问题吗。</p> <ol start="3"><li>不连贯的文档，比如 gulp-eslint 和 eslint，eslint 的文档就是 gulp 插件的文档好得多</li></ol> <p>这不又是废话吗，写个插件还要把用的包的文档重新写一遍?</p> <hr> <p>好了，原文挑剔 gulp 的理由全被扳倒了，但是其中支持 npm 的理由倒是挺有道理:</p> <ol><li>npm scripts 并不需要你很擅长命令行操作</li></ol> <p>你并不需要在 npm scripts 里用一些很高深的命令行，很多 unix 命令是需要花很长时间学习的。像类似 rm -rf 之类的命令很容易掌握，而且也有相应的 npm 包 <a href="https://github.com/isaacs/rimraf" target="_blank" rel="noopener noreferrer">rimraf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 让你使用，且跨平台支持。</p> <ol start="2"><li>npm scripts 不够强大吗?</li></ol> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;clean&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf ./dist &amp;&amp; mkdir dist&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prebuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run clean&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>npm scripts 甚至支持 <code>pre</code> <code>post</code> 这些 hook 让你在相应的一个 task 之前和之后调用。</p> <p>你可以直接执行一个文件来完成相应的构建工作，这让你几乎能做任何 gulp 能做的事:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node build.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>npm scripts 不是跨平台的</li></ol> <p>因为你可能会在 npm scripts 里用一些 unix 命令，解决方案有很多，比如用 npm 包替代这些命令。</p> <ol start="4"><li>可维护性</li></ol> <p>gulp tasks 也多了以后会变得很难维护，npm scripts 也是。解决方案是推荐写精简的 script，比如一个 script 只干一件事。或者很长很复杂的话你就需要专门放到一个 JS 文件里然后再在 npm scripts 里调用了。</p> <h2 id="nswatch"><a href="#nswatch" aria-hidden="true" class="header-anchor">#</a> <span>nswatch</span></h2> <blockquote><p>https://github.com/egoist/nswatch</p></blockquote> <p>在 npm scripts 里只执行一个构建任务你可能不需要类似 <code>gulp.watch</code> 这样的功能，因为大部分构建工具都自带了 watch 功能，比如 <code>webpack --watch</code> 和 <code>rollup --watch</code>，但是排除这种情况在构建多个任务的时候就不方便了。</p> <p>比如你要同时用一些 <code>.jade</code> <code>.css</code> <code>.js</code> 这些文件分别编译成 <code>.html</code> <code>.css</code> <code>.js</code> 文件，开发的时候怎么搞啊，怎么 watch 这些文件然后执行 rebuild 呢？好吧，你又想到了 <code>gulp</code> 😂</p> <p>不过现在有 <code>nswatch</code> 了，为了解决类似的需求我今早洗澡之后写的。和 <code>gulp.watch</code> 类似，监听一些文件，不过这里是执行相应的 npm script。</p> <p>你的 npm scripts:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/build js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:html&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node script/build html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/build css&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后你可以在 <code>scripts/build.js</code> 里用你喜欢的 npm 包，比如 rollup, jade, postcss，来编译相应文件。</p> <p>最后添加 <code>nswatch</code>:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nswatch src/*.js --script build:js &amp; nswatch src/*.css --script build:css  &amp; nswatch src/*.jade --script build:html &quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于有三个任务所以写得很长，你可以把它放进单独文件 <code>scripts/watch.js</code>:</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> watch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nswatch'</span><span class="token punctuation">)</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'./src/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'build:js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'./src/*.jade'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'build:html'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'./src/*.css'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'build:css'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>然后执行 <code>node scripts/watch</code> 一切都能运行了！</p> <p>最后你可能还是需要把 <code>node scripts/watch</code> 写进 <code>package.json</code>，以后都用 <code>npm run watch</code> 来执行:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/watch&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div></div> <!----></div> <footer class="footer" data-v-f119eb06 data-v-4eb3e300><div class="centered" data-v-f119eb06><span class="hide-on-mobile" data-v-f119eb06><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" data-v-f119eb06>CC BY-NC-ND 4.0</a></span> <span data-v-f119eb06>©</span> <span data-v-f119eb06><a data-v-f119eb06>用 npm scripts 和 nswatch 替代 gulp | 庶民样本</a></span> <span class="hide-on-mobile" data-v-f119eb06><a href="https://github.com/undefined" data-v-f119eb06>Read the source code.</a></span></div></footer></div><div class="global-ui"></div></div>
    <script src="/vuepress-theme-egoist/assets/js/3.cef0e0f4.js" defer></script><script src="/vuepress-theme-egoist/assets/js/33.931738c4.js" defer></script><script src="/vuepress-theme-egoist/assets/js/app.fab1506c.js" defer></script>
  </body>
</html>
